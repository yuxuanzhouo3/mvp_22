# GitHub é›†æˆåŠŸèƒ½è¯´æ˜

## æ¦‚è¿°

mornFront ç°åœ¨æ”¯æŒä¸€é”®å°†ç”Ÿæˆçš„å‰ç«¯ä»£ç æ¨é€åˆ° GitHub ä»“åº“ï¼ç”¨æˆ·åªéœ€è¿æ¥ GitHub è´¦æˆ·ï¼Œå°±å¯ä»¥ç›´æ¥å°†ç”Ÿæˆçš„ä»£ç æ¨é€åˆ°è‡ªå·±çš„ GitHub ä»“åº“ã€‚

## ğŸ”‘ é‡è¦è¯´æ˜ï¼šå¤šç”¨æˆ·æ”¯æŒ

**æ¯ä¸ªç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„ GitHub è´¦å·ï¼**

- âœ… **ç‹¬ç«‹æˆæƒ**ï¼šæ¯ä¸ªç”¨æˆ·é€šè¿‡ OAuth æˆæƒè‡ªå·±çš„ GitHub è´¦å·
- âœ… **ç‹¬ç«‹ Token**ï¼šæ¯ä¸ªç”¨æˆ·çš„ GitHub token ç‹¬ç«‹å­˜å‚¨åœ¨æ•°æ®åº“ä¸­
- âœ… **æ¨é€åˆ°è‡ªå·±çš„è´¦å·**ï¼šä»£ç ä¼šæ¨é€åˆ°å½“å‰ç™»å½•ç”¨æˆ·çš„ GitHub è´¦å·
- âœ… **æ•°æ®éš”ç¦»**ï¼šä½¿ç”¨ Row Level Security (RLS) ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„ token

**å·¥ä½œæµç¨‹ï¼š**
1. ç®¡ç†å‘˜é…ç½®ä¸€ä¸ª GitHub OAuth Appï¼ˆæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
2. ç”¨æˆ·Aç‚¹å‡»"Connect GitHub"ï¼Œæˆæƒè‡ªå·±çš„GitHubè´¦å· â†’ è·å¾—ç”¨æˆ·Açš„token
3. ç”¨æˆ·Bç‚¹å‡»"Connect GitHub"ï¼Œæˆæƒè‡ªå·±çš„GitHubè´¦å· â†’ è·å¾—ç”¨æˆ·Bçš„token
4. ç”¨æˆ·Aæ¨é€ä»£ç  â†’ æ¨é€åˆ°ç”¨æˆ·Açš„GitHubè´¦å·
5. ç”¨æˆ·Bæ¨é€ä»£ç  â†’ æ¨é€åˆ°ç”¨æˆ·Bçš„GitHubè´¦å·

## åŠŸèƒ½ç‰¹æ€§

- âœ… **GitHub OAuth è®¤è¯** - å®‰å…¨çš„ OAuth 2.0 è®¤è¯æµç¨‹
- âœ… **å¤šç”¨æˆ·æ”¯æŒ** - æ¯ä¸ªç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„ GitHub è´¦å·
- âœ… **ä¸€é”®æ¨é€** - ç”Ÿæˆä»£ç åä¸€é”®æ¨é€åˆ° GitHub
- âœ… **è‡ªåŠ¨åˆ›å»ºä»“åº“** - è‡ªåŠ¨åˆ›å»ºæ–°çš„ GitHub ä»“åº“
- âœ… **å®Œæ•´é¡¹ç›®ç»“æ„** - æ¨é€æ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶
- âœ… **ç§æœ‰/å…¬å¼€é€‰é¡¹** - æ”¯æŒåˆ›å»ºç§æœ‰æˆ–å…¬å¼€ä»“åº“
- âœ… **çŠ¶æ€æ˜¾ç¤º** - å®æ—¶æ˜¾ç¤º GitHub è¿æ¥çŠ¶æ€

## é…ç½®æ­¥éª¤

### âš ï¸ é‡è¦ï¼šç®¡ç†å‘˜é…ç½®ï¼ˆåªéœ€é…ç½®ä¸€æ¬¡ï¼‰

**åªéœ€è¦ç®¡ç†å‘˜é…ç½®ä¸€æ¬¡ GitHub OAuth Appï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ï¼**

æ¯ä¸ªç”¨æˆ·ä¼šé€šè¿‡è¿™ä¸ª OAuth App æˆæƒè‡ªå·±çš„ GitHub è´¦å·ï¼Œè·å¾—è‡ªå·±çš„ç‹¬ç«‹ tokenã€‚

### 1. åˆ›å»º GitHub OAuth Appï¼ˆç®¡ç†å‘˜æ“ä½œï¼‰

1. è®¿é—® [GitHub Developer Settings](https://github.com/settings/developers)
2. ç‚¹å‡» "New OAuth App"
3. å¡«å†™åº”ç”¨ä¿¡æ¯ï¼š
   - **Application name**: `mornFront` (æˆ–ä½ å–œæ¬¢çš„åç§°)
   - **Homepage URL**: 
     - å¼€å‘ç¯å¢ƒ: `http://localhost:3009`
     - ç”Ÿäº§ç¯å¢ƒ: `https://yourdomain.com`
   - **Authorization callback URL**: 
     - å¼€å‘ç¯å¢ƒ: `http://localhost:3009/api/github/callback`
     - ç”Ÿäº§ç¯å¢ƒ: `https://yourdomain.com/api/github/callback`
4. ç‚¹å‡» "Register application"
5. å¤åˆ¶ **Client ID** å’Œ **Client Secret**

**æ³¨æ„**ï¼šè¿™ä¸ª OAuth App ä¼šè¢«æ‰€æœ‰ç”¨æˆ·å…±äº«ä½¿ç”¨ï¼Œä½†æ¯ä¸ªç”¨æˆ·ä¼šè·å¾—è‡ªå·±çš„ç‹¬ç«‹ tokenã€‚

### 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆç®¡ç†å‘˜æ“ä½œï¼‰

åœ¨ `.env.local` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```env
# GitHub OAuth é…ç½®
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret
NEXT_PUBLIC_APP_URL=http://localhost:3009  # å¼€å‘ç¯å¢ƒ
# NEXT_PUBLIC_APP_URL=https://yourdomain.com  # ç”Ÿäº§ç¯å¢ƒ
```

### 3. è®¾ç½® Supabase æ•°æ®åº“

è¿è¡Œ `supabase-github-schema.sql` æ–‡ä»¶ä¸­çš„ SQL å‘½ä»¤æ¥åˆ›å»ºå¿…è¦çš„æ•°æ®åº“è¡¨ï¼š

1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. è¿›å…¥ SQL Editor
4. å¤åˆ¶ `supabase-github-schema.sql` æ–‡ä»¶çš„å†…å®¹
5. ç²˜è´´å¹¶æ‰§è¡Œ SQL å‘½ä»¤

è¿™å°†åˆ›å»º `user_github_tokens` è¡¨æ¥å®‰å…¨å­˜å‚¨ç”¨æˆ·çš„ GitHub OAuth tokensã€‚

### 4. é‡å¯åº”ç”¨

é…ç½®å®Œæˆåï¼Œé‡å¯å¼€å‘æœåŠ¡å™¨ï¼š

```bash
pnpm dev
```

## ä½¿ç”¨æ–¹æ³•

### ç”¨æˆ·æ“ä½œï¼šè¿æ¥è‡ªå·±çš„ GitHub è´¦æˆ·

**æ¯ä¸ªç”¨æˆ·éœ€è¦å•ç‹¬æˆæƒè‡ªå·±çš„ GitHub è´¦å·ï¼š**

1. ç™»å½•ä½ çš„ mornFront è´¦æˆ·
2. åœ¨ä»£ç ç”Ÿæˆé¡µé¢ï¼Œç‚¹å‡» **"Connect GitHub"** æŒ‰é’®
3. ä¼šè·³è½¬åˆ° GitHub æˆæƒé¡µé¢ï¼Œ**ä½¿ç”¨ä½ è‡ªå·±çš„ GitHub è´¦å·ç™»å½•å¹¶æˆæƒ**
4. æˆæƒæˆåŠŸåï¼Œé¡µé¢ä¼šæ˜¾ç¤º "GitHub Connected" çŠ¶æ€ï¼Œå¹¶æ˜¾ç¤ºä½ çš„ GitHub ç”¨æˆ·å
5. ä½ çš„ GitHub token ä¼šå®‰å…¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œåªä¸ä½ çš„è´¦æˆ·å…³è”

**é‡è¦**ï¼š
- æ¯ä¸ªç”¨æˆ·å¿…é¡»ä½¿ç”¨è‡ªå·±çš„ GitHub è´¦å·æˆæƒ
- ä»£ç ä¼šæ¨é€åˆ°ä½ æˆæƒçš„ GitHub è´¦å·
- å…¶ä»–ç”¨æˆ·çœ‹ä¸åˆ°ä½ çš„ GitHub token

### æ¨é€ä»£ç åˆ° GitHub

1. ç”Ÿæˆå‰ç«¯ä»£ç ï¼ˆä½¿ç”¨ç°æœ‰çš„ä»£ç ç”ŸæˆåŠŸèƒ½ï¼‰
2. ä»£ç ç”Ÿæˆå®Œæˆåï¼Œç‚¹å‡» **"Push to GitHub"** æŒ‰é’®
3. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼š
   - è¾“å…¥ä»“åº“åç§°ï¼ˆé»˜è®¤ä½¿ç”¨é¡¹ç›®åç§°ï¼‰
   - å¯é€‰ï¼šæ·»åŠ ä»“åº“æè¿°
   - é€‰æ‹©æ˜¯å¦åˆ›å»ºç§æœ‰ä»“åº“
4. ç‚¹å‡» **"Push to GitHub"** æŒ‰é’®
5. ç­‰å¾…æ¨é€å®Œæˆ
6. æˆåŠŸåä¼šè‡ªåŠ¨æ‰“å¼€ GitHub ä»“åº“é¡µé¢

## API ç«¯ç‚¹

### GET /api/github/auth
åˆå§‹åŒ– GitHub OAuth æµç¨‹

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <user_session_token>
```

**å“åº”ï¼š**
```json
{
  "authUrl": "https://github.com/login/oauth/authorize?..."
}
```

### GET /api/github/callback
å¤„ç† GitHub OAuth å›è°ƒ

**æŸ¥è¯¢å‚æ•°ï¼š**
- `code`: OAuth æˆæƒç 
- `state`: çŠ¶æ€å‚æ•°ï¼ˆåŒ…å«ç”¨æˆ·IDï¼‰

### POST /api/github/push
æ¨é€ä»£ç åˆ° GitHub

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <user_session_token>
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "project": {
    "projectName": "my-app",
    "files": {
      "src/App.tsx": "...",
      "package.json": "..."
    }
  },
  "repoName": "my-awesome-app",
  "description": "A beautiful app generated by mornFront",
  "isPrivate": false
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "repoUrl": "https://github.com/username/my-awesome-app",
  "cloneUrl": "https://github.com/username/my-awesome-app.git",
  "message": "Successfully pushed to GitHub!"
}
```

### GET /api/github/status
æ£€æŸ¥ GitHub è¿æ¥çŠ¶æ€

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <user_session_token>
```

**å“åº”ï¼š**
```json
{
  "connected": true,
  "username": "github_username"
}
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

1. **Token å­˜å‚¨**: GitHub OAuth tokens å®‰å…¨å­˜å‚¨åœ¨ Supabase æ•°æ®åº“ä¸­ï¼Œä½¿ç”¨ Row Level Security (RLS) ä¿æŠ¤
2. **ç”¨æˆ·éš”ç¦»**: æ¯ä¸ªç”¨æˆ·çš„ token ç‹¬ç«‹å­˜å‚¨ï¼Œç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„ token
3. **OAuth æµç¨‹**: ä½¿ç”¨æ ‡å‡†çš„ OAuth 2.0 æµç¨‹ï¼Œç¡®ä¿å®‰å…¨æ€§
4. **æƒé™èŒƒå›´**: åªè¯·æ±‚ `repo` æƒé™ï¼Œè¶³å¤Ÿåˆ›å»ºå’Œæ¨é€ä»£ç 
5. **HTTPS**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
6. **å¤šç”¨æˆ·æ”¯æŒ**: æ‰€æœ‰ç”¨æˆ·å…±äº«åŒä¸€ä¸ª OAuth Appï¼Œä½†æ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„ token å’Œæƒé™

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ— æ³•è¿æ¥ GitHub

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `GITHUB_CLIENT_ID` å’Œ `GITHUB_CLIENT_SECRET` æ˜¯å¦æ­£ç¡®è®¾ç½®
2. éªŒè¯å›è°ƒ URL æ˜¯å¦ä¸ GitHub OAuth App é…ç½®ä¸€è‡´
3. æ£€æŸ¥ `NEXT_PUBLIC_APP_URL` æ˜¯å¦æ­£ç¡®

### é—®é¢˜ï¼šæ¨é€å¤±è´¥ - ä»“åº“å·²å­˜åœ¨

**è§£å†³æ–¹æ¡ˆï¼š**
- é€‰æ‹©ä¸åŒçš„ä»“åº“åç§°
- æˆ–è€…åˆ é™¤ç°æœ‰çš„åŒåä»“åº“

### é—®é¢˜ï¼šæ•°æ®åº“é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿å·²è¿è¡Œ `supabase-github-schema.sql`
2. æ£€æŸ¥ Supabase è¿æ¥é…ç½®
3. éªŒè¯ RLS ç­–ç•¥æ˜¯å¦æ­£ç¡®è®¾ç½®

## æŠ€æœ¯å®ç°

- **OAuth 2.0**: ä½¿ç”¨ GitHub æ ‡å‡† OAuth æµç¨‹
- **Octokit**: ä½¿ç”¨ `@octokit/rest` åº“ä¸ GitHub API äº¤äº’
- **Supabase**: å­˜å‚¨å’Œç®¡ç†ç”¨æˆ· tokens
- **Next.js API Routes**: å¤„ç†æ‰€æœ‰ GitHub ç›¸å…³è¯·æ±‚

## æœªæ¥å¢å¼º

- [ ] æ”¯æŒæ¨é€åˆ°ç°æœ‰ä»“åº“
- [ ] æ”¯æŒé€‰æ‹©åˆ†æ”¯
- [ ] æ”¯æŒæ·»åŠ  README æ–‡ä»¶
- [ ] æ”¯æŒæ·»åŠ  .gitignore
- [ ] æ”¯æŒè‡ªåŠ¨éƒ¨ç½²åˆ° Vercel/Netlify

---

**äº«å—ä¸€é”®æ¨é€ä»£ç åˆ° GitHub çš„ä¾¿åˆ©ï¼** ğŸš€

