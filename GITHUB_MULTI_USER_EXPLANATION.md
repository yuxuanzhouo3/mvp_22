# GitHub å¤šç”¨æˆ·æ”¯æŒè¯´æ˜

## ğŸ¤” å¸¸è§é—®é¢˜ï¼šæ¯ä¸ªç”¨æˆ·çš„ GitHub è´¦å·éƒ½ä¸åŒï¼Œæ€ä¹ˆåŠï¼Ÿ

**ç­”æ¡ˆï¼šå®Œå…¨æ²¡é—®é¢˜ï¼ç³»ç»Ÿå·²ç»å®Œç¾æ”¯æŒå¤šç”¨æˆ·åœºæ™¯ã€‚**

## ğŸ“‹ å·¥ä½œåŸç†

### 1. OAuth App é…ç½®ï¼ˆåªéœ€ä¸€æ¬¡ï¼‰

**ç®¡ç†å‘˜åªéœ€è¦é…ç½®ä¸€ä¸ª GitHub OAuth App**ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº«ä½¿ç”¨ã€‚

```
ç®¡ç†å‘˜é…ç½® OAuth App
    â†“
æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ª OAuth App
    â†“
æ¯ä¸ªç”¨æˆ·æˆæƒè‡ªå·±çš„ GitHub è´¦å·
    â†“
æ¯ä¸ªç”¨æˆ·è·å¾—è‡ªå·±çš„ç‹¬ç«‹ token
```

### 2. ç”¨æˆ·æˆæƒæµç¨‹

å½“ç”¨æˆ·ç‚¹å‡»"Connect GitHub"æ—¶ï¼š

1. **ç”¨æˆ·A** ç‚¹å‡» "Connect GitHub"
   - è·³è½¬åˆ° GitHub æˆæƒé¡µé¢
   - ç”¨æˆ·Aä½¿ç”¨è‡ªå·±çš„GitHubè´¦å·ç™»å½•
   - æˆæƒåï¼Œè·å¾—ç”¨æˆ·Açš„GitHub token
   - Tokenå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå…³è”åˆ°ç”¨æˆ·Açš„è´¦æˆ·ID

2. **ç”¨æˆ·B** ç‚¹å‡» "Connect GitHub"
   - è·³è½¬åˆ° GitHub æˆæƒé¡µé¢
   - ç”¨æˆ·Bä½¿ç”¨è‡ªå·±çš„GitHubè´¦å·ç™»å½•ï¼ˆå¯èƒ½æ˜¯ä¸åŒçš„è´¦å·ï¼‰
   - æˆæƒåï¼Œè·å¾—ç”¨æˆ·Bçš„GitHub token
   - Tokenå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå…³è”åˆ°ç”¨æˆ·Bçš„è´¦æˆ·ID

### 3. ä»£ç æ¨é€æµç¨‹

å½“ç”¨æˆ·æ¨é€ä»£ç æ—¶ï¼š

1. **ç”¨æˆ·A** æ¨é€ä»£ç 
   - ç³»ç»Ÿä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·Açš„GitHub token
   - ä½¿ç”¨ç”¨æˆ·Açš„tokenåˆ›å»ºä»“åº“
   - ä»£ç æ¨é€åˆ°ç”¨æˆ·Açš„GitHubè´¦å·

2. **ç”¨æˆ·B** æ¨é€ä»£ç 
   - ç³»ç»Ÿä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·Bçš„GitHub token
   - ä½¿ç”¨ç”¨æˆ·Bçš„tokenåˆ›å»ºä»“åº“
   - ä»£ç æ¨é€åˆ°ç”¨æˆ·Bçš„GitHubè´¦å·

## ğŸ”’ æ•°æ®éš”ç¦»

### æ•°æ®åº“ç»“æ„

```sql
user_github_tokens è¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_id  â”‚ github_token     â”‚ github_username â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user-A   â”‚ token-abc123...  â”‚ alice-github    â”‚
â”‚ user-B   â”‚ token-xyz789...  â”‚ bob-github      â”‚
â”‚ user-C   â”‚ token-def456...  â”‚ charlie-github  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Row Level Security (RLS)

æ•°æ®åº“ä½¿ç”¨ RLS ç­–ç•¥ç¡®ä¿ï¼š
- âœ… ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ token
- âœ… ç”¨æˆ·åªèƒ½æ›´æ–°è‡ªå·±çš„ token
- âœ… ç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„ token
- âœ… ç”¨æˆ·Aæ— æ³•è®¿é—®ç”¨æˆ·Bçš„ token

## ğŸ“Š å®é™…ç¤ºä¾‹

### åœºæ™¯ï¼šä¸‰ä¸ªç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿ

**ç”¨æˆ· Alice (alice@example.com)**
1. ç™»å½• mornFront
2. ç‚¹å‡» "Connect GitHub"
3. ä½¿ç”¨ GitHub è´¦å· `alice-github` æˆæƒ
4. ç”Ÿæˆä»£ç å¹¶æ¨é€
5. ä»£ç æ¨é€åˆ° `https://github.com/alice-github/my-app`

**ç”¨æˆ· Bob (bob@example.com)**
1. ç™»å½• mornFront
2. ç‚¹å‡» "Connect GitHub"
3. ä½¿ç”¨ GitHub è´¦å· `bob-github` æˆæƒï¼ˆä¸åŒçš„è´¦å·ï¼‰
4. ç”Ÿæˆä»£ç å¹¶æ¨é€
5. ä»£ç æ¨é€åˆ° `https://github.com/bob-github/my-app`

**ç”¨æˆ· Charlie (charlie@example.com)**
1. ç™»å½• mornFront
2. ç‚¹å‡» "Connect GitHub"
3. ä½¿ç”¨ GitHub è´¦å· `charlie-github` æˆæƒï¼ˆåˆæ˜¯ä¸åŒçš„è´¦å·ï¼‰
4. ç”Ÿæˆä»£ç å¹¶æ¨é€
5. ä»£ç æ¨é€åˆ° `https://github.com/charlie-github/my-app`

## âœ… å…³é”®ç‚¹æ€»ç»“

1. **OAuth App**: åªéœ€é…ç½®ä¸€ä¸ªï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº«
2. **Token**: æ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„ token
3. **GitHub è´¦å·**: æ¯ä¸ªç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„ GitHub è´¦å·
4. **æ•°æ®éš”ç¦»**: RLS ç¡®ä¿ç”¨æˆ·æ•°æ®å®Œå…¨éš”ç¦»
5. **æ¨é€ç›®æ ‡**: ä»£ç æ¨é€åˆ°å½“å‰ç”¨æˆ·çš„ GitHub è´¦å·

## ğŸ” ä»£ç å®ç°ç»†èŠ‚

### 1. OAuth æˆæƒæ—¶ä¿å­˜ç”¨æˆ·ID

```typescript
// app/api/github/auth/route.ts
const state = Buffer.from(JSON.stringify({ userId: user.id })).toString('base64')
```

### 2. å›è°ƒæ—¶å…³è”ç”¨æˆ·IDå’ŒToken

```typescript
// app/api/github/callback/route.ts
await supabaseAdmin
  .from('user_github_tokens')
  .upsert({
    user_id: userId,  // å½“å‰ç”¨æˆ·çš„ID
    github_token: accessToken,  // è¯¥ç”¨æˆ·çš„GitHub token
    github_username: githubUser.login,  // è¯¥ç”¨æˆ·çš„GitHubç”¨æˆ·å
  })
```

### 3. æ¨é€æ—¶ä½¿ç”¨å½“å‰ç”¨æˆ·çš„Token

```typescript
// app/api/github/push/route.ts
const { data: tokenData } = await supabaseAdmin
  .from('user_github_tokens')
  .select('github_token, github_username')
  .eq('user_id', user.id)  // åªæŸ¥è¯¢å½“å‰ç”¨æˆ·çš„token
  .single()

const octokit = new Octokit({
  auth: tokenData.github_token,  // ä½¿ç”¨å½“å‰ç”¨æˆ·çš„token
})
```

## ğŸ¯ ç»“è®º

**ç³»ç»Ÿå®Œå…¨æ”¯æŒå¤šç”¨æˆ·åœºæ™¯ï¼**

- âœ… æ¯ä¸ªç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„ GitHub è´¦å·
- âœ… æ¯ä¸ªç”¨æˆ·çš„ token ç‹¬ç«‹å­˜å‚¨
- âœ… ä»£ç æ¨é€åˆ°å„è‡ªçš„ GitHub è´¦å·
- âœ… æ•°æ®å®Œå…¨éš”ç¦»å’Œå®‰å…¨

**ç”¨æˆ·æ— éœ€ä»»ä½•é¢å¤–é…ç½®ï¼Œåªéœ€æˆæƒè‡ªå·±çš„ GitHub è´¦å·å³å¯ï¼**

































